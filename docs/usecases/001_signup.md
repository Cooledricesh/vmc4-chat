# Usecase 001: 회원가입

**문서 번호:** UC-001
**기능명:** 회원가입
**작성일:** 2025-10-19
**관련 유저플로우:** 1. 회원가입 유저플로우

---

## 1. 개요

사용자가 이메일, 비밀번호, 닉네임을 입력하여 Cokaotalk 계정을 생성하는 기능입니다. 회원가입 완료 후 로그인 페이지로 자동 리디렉션됩니다.

---

## 2. 사전 조건

- 사용자가 회원가입 페이지(/register)에 접근할 수 있어야 합니다.
- 데이터베이스 users 테이블이 정상적으로 구성되어 있어야 합니다.
- bcrypt 라이브러리가 설치되어 비밀번호 해싱이 가능해야 합니다.

---

## 3. 액터

- **주 액터:** 신규 사용자 (비회원)
- **부 액터:** Cokaotalk 백엔드 시스템, 데이터베이스

---

## 4. 기본 시나리오 (정상 흐름)

### 4.1. 회원가입 페이지 진입
1. 사용자가 로그인 페이지에서 "회원가입" 링크를 클릭합니다.
2. 시스템이 회원가입 페이지(/register)로 이동합니다.

### 4.2. 정보 입력
3. 사용자가 다음 정보를 입력합니다:
   - 이메일 주소 (예: user@example.com)
   - 비밀번호 (최소 8자 이상)
   - 비밀번호 확인 (비밀번호와 동일하게 입력)
   - 닉네임 (1-50자)

### 4.3. 클라이언트 유효성 검증
4. 시스템이 입력값을 실시간으로 검증합니다:
   - 이메일: RFC 5322 표준 형식 확인
   - 비밀번호: 최소 8자 이상 확인
   - 비밀번호 확인: 비밀번호와 일치 여부 확인
   - 닉네임: 1-50자 길이 확인

### 4.4. 회원가입 요청
5. 사용자가 "회원가입" 버튼을 클릭합니다.
6. 시스템이 회원가입 버튼을 비활성화하여 중복 제출을 방지합니다.

### 4.5. 서버 검증 및 저장
7. 서버가 다음을 수행합니다:
   - 이메일 중복 확인 (users 테이블 조회)
   - 입력값 재검증 (Zod 스키마)
   - 비밀번호 bcrypt 해싱 (솔트 라운드 10)
   - UUID 생성
   - users 테이블에 INSERT:
     ```sql
     INSERT INTO users (id, email, nickname, password_hash, created_at, updated_at)
     VALUES (gen_random_uuid(), $1, $2, $3, NOW(), NOW());
     ```

### 4.6. 성공 응답 및 리디렉션
8. 서버가 성공 응답을 반환합니다.
9. 클라이언트가 "회원가입이 완료되었습니다" 메시지를 표시합니다.
10. 시스템이 자동으로 로그인 페이지(/login)로 리디렉션합니다.

---

## 5. 대체 시나리오 (예외 상황)

### 5.1. 이메일 형식 오류
- **조건:** 사용자가 잘못된 이메일 형식을 입력 (예: "user@")
- **결과:** 이메일 입력 필드 하단에 "올바른 이메일 형식을 입력해주세요" 오류 메시지 표시
- **복구:** 사용자가 올바른 형식으로 수정 후 재시도

### 5.2. 비밀번호 길이 부족
- **조건:** 비밀번호가 8자 미만
- **결과:** 비밀번호 입력 필드 하단에 "비밀번호는 최소 8자 이상이어야 합니다" 오류 메시지 표시
- **복구:** 사용자가 8자 이상으로 수정 후 재시도

### 5.3. 비밀번호 불일치
- **조건:** 비밀번호와 비밀번호 확인이 일치하지 않음
- **결과:** 비밀번호 확인 필드 하단에 "비밀번호가 일치하지 않습니다" 오류 메시지 표시
- **복구:** 사용자가 동일하게 입력 후 재시도

### 5.4. 닉네임 길이 오류
- **조건:** 닉네임이 비어있거나 50자 초과
- **결과:** 닉네임 입력 필드 하단에 "닉네임은 1-50자 사이여야 합니다" 오류 메시지 표시
- **복구:** 사용자가 적절한 길이로 수정 후 재시도

### 5.5. 이메일 중복
- **조건:** 동일한 이메일이 이미 users 테이블에 존재
- **결과:**
  - HTTP 409 Conflict 응답
  - "이미 사용 중인 이메일입니다" 오류 메시지 표시
- **복구:** 사용자가 다른 이메일로 재시도하거나 로그인 페이지로 이동

### 5.6. 네트워크 오류
- **조건:** 회원가입 요청 중 네트워크 연결 끊김
- **결과:**
  - 로딩 스피너 표시 후 타임아웃 (30초)
  - "네트워크 연결을 확인해주세요" 오류 메시지 표시
  - 회원가입 버튼 재활성화
- **복구:** 사용자가 네트워크 확인 후 재시도

### 5.7. 서버 오류
- **조건:** 데이터베이스 연결 실패 또는 내부 서버 오류
- **결과:**
  - HTTP 500 Internal Server Error 응답
  - "일시적인 오류가 발생했습니다. 잠시 후 다시 시도해주세요" 메시지 표시
  - 회원가입 버튼 재활성화
- **복구:** 사용자가 잠시 후 재시도

### 5.8. SQL Injection 시도
- **조건:** 악의적인 SQL 구문 입력 시도 (예: `'; DROP TABLE users; --`)
- **결과:**
  - 파라미터 바인딩으로 자동 이스케이프 처리
  - 입력값 그대로 문자열로 저장 (실행되지 않음)
- **보안:** Prepared Statement 사용으로 근본적 차단

### 5.9. XSS 공격 시도
- **조건:** 악의적인 스크립트 입력 (예: `<script>alert('xss')</script>`)
- **결과:**
  - 입력값 sanitization 처리
  - 렌더링 시 자동 이스케이프
- **보안:** DOMPurify 또는 React의 기본 XSS 방어 메커니즘 활용

---

## 6. 사후 조건

### 성공 시
- users 테이블에 새로운 사용자 레코드가 생성됩니다.
- 비밀번호는 bcrypt로 해싱되어 password_hash 필드에 저장됩니다.
- 사용자는 로그인 페이지로 이동하여 바로 로그인할 수 있습니다.

### 실패 시
- 데이터베이스에 어떠한 변경도 발생하지 않습니다.
- 사용자는 회원가입 페이지에 그대로 유지됩니다.
- 입력한 정보는 보안 정보(비밀번호)를 제외하고 유지됩니다.

---

## 7. 비기능적 요구사항

### 7.1. 성능
- 회원가입 처리 시간: 2초 이내
- 클라이언트 유효성 검증: 실시간 (입력 종료 후 300ms 디바운스)

### 7.2. 보안
- 비밀번호는 절대 평문으로 저장하지 않음
- bcrypt 솔트 라운드: 10 이상
- HTTPS 필수 (평문 전송 금지)
- CSRF 토큰 검증

### 7.3. 접근성
- 모든 입력 필드에 적절한 label 연결
- 오류 메시지는 스크린 리더가 읽을 수 있도록 aria-live 영역에 표시
- 키보드만으로 모든 기능 접근 가능

### 7.4. 사용성
- 비밀번호 표시/숨김 토글 버튼 제공
- 오류 메시지는 해당 필드 바로 하단에 표시
- 성공/실패 피드백 명확하게 제공

---

## 8. UI/UX 요구사항

### 8.1. 레이아웃
- 중앙 정렬된 회원가입 폼 (최대 너비 400px)
- 모바일 반응형 디자인 (320px 이상 지원)

### 8.2. 입력 필드
- **이메일:** type="email", placeholder="user@example.com"
- **비밀번호:** type="password", placeholder="최소 8자 이상"
- **비밀번호 확인:** type="password", placeholder="비밀번호 재입력"
- **닉네임:** type="text", placeholder="닉네임 (1-50자)"

### 8.3. 버튼
- **회원가입 버튼:**
  - 기본 상태: 활성화, 파란색 배경
  - 비활성 상태: 회색 배경, 커서 not-allowed
  - 로딩 상태: 스피너 표시, "처리 중..." 텍스트

### 8.4. 오류 표시
- 오류 메시지 색상: 빨간색 (#DC2626)
- 오류 발생 필드: 빨간색 테두리
- 아이콘: 느낌표 또는 X 아이콘

### 8.5. 성공 표시
- 성공 메시지: 초록색 배경 토스트 알림
- 자동 리디렉션 안내: "3초 후 로그인 페이지로 이동합니다"

---

## 9. 데이터베이스 영향

### 생성되는 레코드
```sql
-- users 테이블에 INSERT
{
  id: "550e8400-e29b-41d4-a716-446655440000",
  email: "user@example.com",
  nickname: "사용자닉네임",
  password_hash: "$2b$10$...",  -- bcrypt 해시
  created_at: "2025-10-19T12:00:00Z",
  updated_at: "2025-10-19T12:00:00Z"
}
```

### 인덱스 활용
- `idx_users_email`: 이메일 중복 확인 시 사용

---

## 10. API 명세

### Endpoint
```
POST /api/auth/register
```

### Request Body
```json
{
  "email": "user@example.com",
  "password": "securepassword123",
  "passwordConfirm": "securepassword123",
  "nickname": "사용자닉네임"
}
```

### Response (성공)
```json
{
  "success": true,
  "message": "회원가입이 완료되었습니다",
  "data": {
    "userId": "550e8400-e29b-41d4-a716-446655440000"
  }
}
```

### Response (실패 - 이메일 중복)
```json
{
  "success": false,
  "error": {
    "code": "EMAIL_ALREADY_EXISTS",
    "message": "이미 사용 중인 이메일입니다"
  }
}
```

---

## 11. 테스트 시나리오

### 11.1. 정상 케이스
- [ ] 유효한 정보로 회원가입 성공
- [ ] 회원가입 후 로그인 페이지로 리디렉션
- [ ] 생성된 계정으로 로그인 가능

### 11.2. 유효성 검증
- [ ] 잘못된 이메일 형식 입력 시 오류 메시지
- [ ] 7자 이하 비밀번호 입력 시 오류 메시지
- [ ] 비밀번호 불일치 시 오류 메시지
- [ ] 빈 닉네임 입력 시 오류 메시지
- [ ] 51자 이상 닉네임 입력 시 오류 메시지

### 11.3. 중복 검증
- [ ] 동일 이메일 재가입 시도 시 오류 응답

### 11.4. 보안
- [ ] 비밀번호가 bcrypt로 해싱되어 저장됨
- [ ] SQL Injection 시도 차단
- [ ] XSS 공격 시도 차단

### 11.5. UX
- [ ] 중복 제출 방지 (버튼 비활성화)
- [ ] 네트워크 오류 시 재시도 가능
- [ ] 모바일 환경에서 정상 동작

---

## 12. 관련 문서

- [유저플로우 문서 - 1. 회원가입](../userflow.md#1-회원가입-유저플로우)
- [데이터베이스 설계 - users 테이블](../database.md#1-users-테이블)
- [PRD - 회원가입 기능](../prd.md)
